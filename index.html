<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase同期メモ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="icon" href="data:,">
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        textarea { width: 90%; height: 200px; margin-top: 10px; font-size: 16px; }
        #qrcode { margin-top: 20px; display: inline-block; }
    </style>
</head>
<body>
    <h1>Firebase同期メモ</h1>
    <div id="qrcode"></div>
    <textarea id="sharedText" placeholder="ここにテキストを入力..."></textarea>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDYB85ij4gJH6ouCSMaZHCS2zC77T_1pfo",
            authDomain: "textdrop-6f4e5.firebaseapp.com",
            projectId: "textdrop-6f4e5",
            storageBucket: "textdrop-6f4e5.appspot.com",
            messagingSenderId: "1003920001497",
            appId: "1:1003920001497:web:e7fe245971b54e808371c8",
            measurementId: "G-2WV05QX9JX"
        };

        // Firebase 初期化
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const textArea = document.getElementById("sharedText");
        const qrCodeElement = document.getElementById("qrcode");
        
        const docRef = doc(db, "shared", "text");

        // Firestoreのデータを監視し、変更時に更新
        onSnapshot(docRef, (docSnap) => {
            if (docSnap.exists()) {
                textArea.value = docSnap.data().content;
            }
        });

        // テキスト変更時にFirestoreへ保存
        textArea.addEventListener("input", () => {
            setDoc(docRef, { content: textArea.value });
        });

        // QRコードを生成（現在のURLをQRコード化）
        try {
            new QRCode(qrCodeElement, {
                text: window.location.href,
                width: 150,
                height: 150
            });
        } catch (error) {
            console.error("QRコード生成エラー: ", error);
        }
    </script>
</body>
</html>
